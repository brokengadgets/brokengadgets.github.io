<!DOCTYPE html>
<html lang="en-us">
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    
    <title>Mumen Controller | Broken Gadgets R&amp;D</title>
    <meta name="viewport" content="width=device-width,minimum-scale=1">
    <meta name="description" content="Checking my git logs, I&rsquo;ve worked on what would become mumen-controller for nearly 3 years at the time of writing this and have never stopped to record my progress in a useful way (though I have written about it in various private chat with friends and posted photos of build progress to a few group chats). For the beginning of this post, I&rsquo;ll focus on a historical recap to the best of my available records and recollection. Some details may be slightly deviated from the way things went, but it should give a useful-enough background on the project, some of the hurdles to cross, and where the current goals were generated.">
    <meta name="generator" content="Hugo 0.140.2">
    
    
    
      <meta name="robots" content="noindex, nofollow">
    
    

    
<link rel="stylesheet" href="/ananke/css/main.min.css" >



    

    
      

    

    

    
      <link rel="canonical" href="http://localhost:1313/mumen-controller/">
    

    <meta property="og:url" content="http://localhost:1313/mumen-controller/">
  <meta property="og:site_name" content="Broken Gadgets R&D">
  <meta property="og:title" content="Mumen Controller">
  <meta property="og:description" content="Checking my git logs, I’ve worked on what would become mumen-controller for nearly 3 years at the time of writing this and have never stopped to record my progress in a useful way (though I have written about it in various private chat with friends and posted photos of build progress to a few group chats). For the beginning of this post, I’ll focus on a historical recap to the best of my available records and recollection. Some details may be slightly deviated from the way things went, but it should give a useful-enough background on the project, some of the hurdles to cross, and where the current goals were generated.">
  <meta property="og:locale" content="en_us">
  <meta property="og:type" content="article">
    <meta property="article:published_time" content="2025-01-11T19:16:03-05:00">
    <meta property="article:modified_time" content="2025-01-11T19:16:03-05:00">

  <meta itemprop="name" content="Mumen Controller">
  <meta itemprop="description" content="Checking my git logs, I’ve worked on what would become mumen-controller for nearly 3 years at the time of writing this and have never stopped to record my progress in a useful way (though I have written about it in various private chat with friends and posted photos of build progress to a few group chats). For the beginning of this post, I’ll focus on a historical recap to the best of my available records and recollection. Some details may be slightly deviated from the way things went, but it should give a useful-enough background on the project, some of the hurdles to cross, and where the current goals were generated.">
  <meta itemprop="datePublished" content="2025-01-11T19:16:03-05:00">
  <meta itemprop="dateModified" content="2025-01-11T19:16:03-05:00">
  <meta itemprop="wordCount" content="1753">
  <meta name="twitter:card" content="summary">
  <meta name="twitter:title" content="Mumen Controller">
  <meta name="twitter:description" content="Checking my git logs, I’ve worked on what would become mumen-controller for nearly 3 years at the time of writing this and have never stopped to record my progress in a useful way (though I have written about it in various private chat with friends and posted photos of build progress to a few group chats). For the beginning of this post, I’ll focus on a historical recap to the best of my available records and recollection. Some details may be slightly deviated from the way things went, but it should give a useful-enough background on the project, some of the hurdles to cross, and where the current goals were generated.">

	
  </head><body class="ma0 avenir bg-near-black near-white development">

    

  
  
  
  <header class="cover bg-center" style="background-image: url('http://localhost:1313/images/controller.webp');">
    <div class="bg-black-60">
      <nav class="pv3 ph3 ph4-ns" role="navigation">
  <div class="flex-l justify-between items-center center">
    <a href="/" class="f3 fw2 hover-white no-underline white-90 dib">
      <img src="/images/bgr.svg" width=50% class="w100 mw5-ns" alt="Broken Gadgets R&amp;D" />
    </a>
    <div class="flex-l items-center">
      

      
        <ul class="pl0 mr3">
          
          <li class="list f5 f4-ns fw4 dib pr3">
            <a class="hover-white no-underline white-90" href="/contact/" title="Contact page">
              Contact
            </a>
          </li>
          
        </ul>
      
      <div class="ananke-socials"></div>

    </div>
  </div>
</nav>

      <div class="tc-l pv6 ph3 ph4-ns">
        
          <div class="f2 f1-l fw2 white-90 mb0 lh-title">Mumen Controller</div>
          
        
      </div>
    </div>
  </header>


    <main class="pb7" role="main">
      
  <div class="flex-l mt2 mw8 center">
    <article class="center cf pv5 ph3 ph4-ns mw7">
      <header>
        <h1 class="f1">
          Mumen Controller
        </h1>
      </header>
      <div class="nested-copy-line-height lh-copy f4 nested-links near-white">
        <p>Checking my git logs, I&rsquo;ve worked on what would become mumen-controller for nearly 3 years at the time of writing this and have never stopped to record my progress in a useful way (though I have written about it in various private chat with friends and posted photos of build progress to a few group chats). For the beginning of this post, I&rsquo;ll focus on a historical recap to the best of my available records and recollection. Some details may be slightly deviated from the way things went, but it should give a useful-enough background on the project, some of the hurdles to cross, and where the current goals were generated.</p>
<h3 id="-the-motivation-">🥊 The Motivation 🥊</h3>
<p>I&rsquo;m not any good at fighting games, but I admire the dedication excellent players demonstrate. Even the casual players I have associated with take the game very seriously and using their controllers is invaluably fun. Upon looking into buying or building my own fight stick, hitbox, or arcade pad, I was appalled at how expensive the whole process was and sought to perform a lot of the work by repurposing junk around the house. In repurposing junk, I ended up with a $5 devkit: the sparkfun pro micro driven by the Atmega 32U4. I had a few in my drawer and thought I&rsquo;d just make one dance as a fightstick.
<img src="/images/promicro.webp" alt="Sparkfun Pro Micro"></p>
<h3 id="-we-came-from-nothing-">📦 We came from Nothing 📦</h3>
<p>I ordered a joystick unit and once it arrived, I disassembled an old gaming keyboard and stuck it all into a cardboard box with no concern whatsoever for rectifier diodes. After a short period, it became clear the cardboard case was insufficient for the amount of force used in fighting games, so the center was reinforced with a series of large toy blocks hot glued in place. The stick was repurposed for the next iteration before this photo was captured.
<img src="/images/unlicensed-cardboard50.webp" alt="Unlicensed Cardboard: a Beautiful Success."></p>
<p>Somewhere in parallel with that effort (it looks like all 11 commits were on May 1, 2022) I rolled together <a href="https://github.com/nulvox/UnlicProController">UnlicProController</a>. For that project, I initially planned to only install the firmware provided by the <a href="https://github.com/fluffymadness/ATMega32U4-Switch-Fightstick">similar project from fluffymadness</a>, but whickly found myself changing enough to make it my own repo and developing features other users would not want. Once it was working and I had no sane way to upstream my changes, I did what any reasonable person would:</p>
<p><code>rm -rf .git ; git init UnlicProController</code>.</p>
<h3 id="-im-a-real-controller-">🤥 I&rsquo;m a real controller! 🤥</h3>
<p>My obvious next step was to make a better case and use nicer keys, so I got to work with some old pallet wood from an appliance I purchased and a $15 laminated oak board from Lowes, making the true form of the UnlicProController case.</p>
<p><img src="/images/unlicensed-wood50.webp" alt="Unlicensed Wood: a boat of a controller"></p>
<p>While this case feels great to play on, the controller weighs 8.7lbs and takes up an unruly amount of desk space. To top it off the firmware is this mostly ripped off thing that I didn&rsquo;t love a lot of the backing libraries for (but was unwilling to clean up in the existing codebase).</p>
<p>So I started down the pathway of a new firmware from the ground up and thought I&rsquo;d just give rust a swing because I could find some low level board support for the Atmega 32u4 and I was having a good time with the language in a few other projects:</p>
<pre tabindex="0"><code>cargo new mumen-controller 
cd mumen-controller  
git init MumenController
</code></pre><h3 id="-feeling-a-little-rusty-">🦀 Feeling a little Rusty 🦀</h3>
<p>The <a href="https://github.com/nulvox/MumenController">main branch</a> underwent a rocky lifetime so far. Even on such a small and low power devkit, I found that the admittedly sloppy C++ implementation was surprisingly low latency as far as the industry is concerned (maybe someday there will be a post about assembling the standard controller latency tools). That coupled with learning about the <a href="https://github.com/OpenStickCommunity/GP2040-CE">GP2040-CE</a>&rsquo;s superior I/O array and feature<del>bloat</del>set, it was clear MumenController should aim for speed. In that realm, the top competitor is the <a href="https://focusattack.com/brook-p5-mini-fight-board-pcba/">Brook P5 Mini</a> which has ~8ms latency and firmware-driven SOCD-cleaning (saving the extra component and any additional latency that might introduce) but also brings some interesting shortcomings:</p>
<ul>
<li>Only supports connecting as a wired PS5 controller</li>
<li>No support for the <a href="https://focusattack.com/bundle-japan-wiring-for-brook-ufb-gp2040-ce/">Brook Universal Fighting Board Wiring Harness</a>
<ul>
<li>🧐 curious that they would create a standard then break it themselves 🧐</li>
<li>Users have to solder themselves. Nothing I&rsquo;m not used to, but not what I expect from a product at $60</li>
</ul>
</li>
<li>No support for analog inputs
<ul>
<li>Though it does support pretty standard analog emulation</li>
<li>and neat PS5 touchpad emulation!
<img src="/images/brook-front50.webp" alt="Brook P5 Mini front: notice the potting compound on the small chip in the bottom left"> <img src="/images/brook-back50.webp" alt="Brook P5 Mini back: this footprint suggests the small chip is the MCU"></li>
</ul>
</li>
</ul>
<p>In the process of making the rust firmware more efficient, I eventually uncovered a messy showstopper: the C++ firmware was running with an unavoidable race condition this whole time and rustc was having no part of it even with extensive coaxing. Specifically, the hardware atomics on the ProMicro were only half as wide as needed to write the HID Descriptor table for the Switch Pro Controllers. 😵 Time to change.</p>
<h3 id="wastefully-and-whimsically-migrating-hardware">✨Wastefully and Whimsically Migrating Hardware✨</h3>
<p>Knowing we had to change and speed was a goal, it seemed clear to look for a platform with more robust support in the embedded rust community. A quick search through <a href="https://crates.io/search?q=bsp">crates.io</a> showed quite a few better options, but already having a teeny4.1 sitting on the desk next to me (and having a few other projects on the platform to tinker with), I thought I&rsquo;d take a peek at the rust support (which is <a href="https://crates.io/crates/teensy4-bsp">pretty awesome</a>). While the cost is absurd, it&rsquo;s still about half the cost (at this point) of buying a Brook board and a lot more flexible. Promising to remove my atomics race headache and provide notably faster cores (likely faster than what Brook is using if I had to guess what is behind the delicious potting compound) it seemed prudent to build the funnycar of fightsticks. The redesign also went along with a hitbox style and ditched the old concept of the shift key (at least for now) to provide a faster processing goal and cut out some of the fluff unrelated to the project&rsquo;s target niche in the ecosystem.
<img src="/images/teensy4.1-70.webp" alt="Teensy4.1"> <img src="/images/teensy4.0-25.webp" alt="Teensy 4.0"></p>
<p>While working those hardware angles, the mess of a wiring harness was another piece of techdebt to address. With the 22awg coated wires we had on-hand and the various kinds of perfboards we tried working with, this was all around a nightmare. Once a few Brook harness headers came in, we thought we would just solder across a perfboard to those and it was still a nightmare. After a short period of research, the next action was clear: <code>sudo pacman -S kicad</code>. Having never designed a pcb before and seeing an enticing <del>bait</del>sale on <a href="https://www.pcbway.com/Member/Login/?from=bingSE06">PCBWay</a>, KiCad was launched and a new board was being designed.</p>
<p><img src="/images/pcb-layout50.webp" alt="Final Printed Layout"></p>
<p>These simple boards provide a pinout to the 20-pin Brook header, some extra pins for our use on other features, through-holes for rectifier diodes, a footprint for the tensy4.0, and now a significantly higher cost that the Brook board. 10 of them were ordered from PCBW and they showed up surprisingly quickly. We immediately populated a few.
<img src="/images/board-stack.webp" alt="Stax">
<img src="/images/populating.webp" alt="WIP"></p>
<p>While waiting on those boards to arrive, the new case needed to be built and the clear top face needed some art. With some cheap acrylic paints lying on a shelf, some pretty neat imagery was layered onto the clear acrylic sheet. The cheap paints didn&rsquo;t stick well to the surface and took a long time to dry coupled with the need to layer the paint in an unusual way (front layers need to come first to show up closest to the underside of the clear panel), this took a long time to get onto the page. While waiting for the paint layers to dry, it was easy to get a new wooden frame made from an oak 1x2 and a plain acrylic sheet from Lowes.<br>
<img src="/images/paint-layout.webp" alt="Laying out the design"> <img src="/images/paint-wip1.webp" alt="A few layers in"> <img src="/images/paint-wip2-50.webp" alt="More layers"> <img src="/images/frame50.webp" alt="The frame and bottom layer mostly sanded and smoothed"> <img src="/images/controller.webp" alt="mumen-controller face"></p>
<h3 id="-standing-out-to-fit-in-">🥸 Standing Out to Fit-in 🥸</h3>
<p>As already mentioned in brief, there are a lot of competing fighting game controller implementations out there and having a place that works for any product in any market means having something to stand apart from the rest with.</p>
<ul>
<li>The Gold standard for builders: <a href="https://focusattack.com/brook-gen-5x-multi-console-pc-fighting-board/">Brook Universal Fighting</a> $74.95</li>
<li>An older classic: <a href="https://focusattack.com/brook-zero-pi-fighting-board-pi-ps3-ps2-psx-pc-switch/">Brook ZeroPi</a> $24.95</li>
<li>The modern Speed demon: <a href="https://focusattack.com/brook-p5-mini-fight-board-pcba/">Brook P5 Mini</a> $59.95
<ul>
<li>🤔 Interesting that 1 company has done so well for so long.</li>
</ul>
</li>
<li>Feature-rich DIY/FOSS Solution: <a href="https://focusattack.com/gp2040-ce-v5-6e-usb-b-usb-c-open-source-multi-console-fight-board/">GP2040-CE</a> $34.99
There are a few additional options available, but those I am aware of are either lacking a stand-out quality or don&rsquo;t ship with a key component built-in (ie, they are not presented meaningfully as a product).
Looking at this market, I see that the Brook offerings are going to stay and more or less be a baseline. The GP2040-CE does an excellent job of providing a wider feature set than the Brook options and has the benefit of running the same firmware on a number of other boards (with just some small changes to build options). The project is mature, large, and dense; a feature set like that is not a realm to compete with and the RP2040 is <a href="https://octopart.com/102110545-seeed+studio-116237358">a little pricy</a>, but <a href="https://octopart.com/mimxrt1062cvl5b-nxp+semiconductors-105790568">not terribly out of sight</a>. The GP2040-CE is also available ready to go at a very low price as far as this market is concerned.
The commercial competitor there is the Universal Fighting Board which does a lot of great things for the user:</li>
<li>SOCD cleaning</li>
<li>Console support switching</li>
<li>Signal rectifier diodes</li>
<li>A standard header for buttons</li>
<li>Brook touchpad emulation</li>
</ul>
<h4 id="what-about-speed">What About Speed</h4>
<p>To compete against the speed demon, it is important to perform faster than the current leader and provide a superior feature set. What does the P5Mini do?</p>
<ul>
<li>PS3/4/5 support (Xinput for PC, console auto-detection)</li>
<li>Firmware-side SOCD cleaning (with multiple profiles to choose from at controller boot-time)</li>
<li>USB-firmware upgrades (no disassembly)</li>
<li>Analog-stick emulation (with a 3-second long-press to toggle)</li>
<li>an impressive 8ms input latency</li>
</ul>
<p>Some target features might include:</p>
<ul>
<li>Wider or different console support</li>
<li>True-analog support</li>
<li>Less input latency? 🤷</li>
<li>Easier to use connections</li>
<li>Some layer of flexibility missing from P5Mini</li>
</ul>
<p>While the targets here are pretty steep to still maintain low latency, I&rsquo;ve done a bit of lean embedded development before and I think I have a few tricks up my sleeves to help eek out ahead while still having more features, but it&rsquo;s going to take a while to get it set up just right. 😉
Future updates and posts may cover topics such as:</p>
<ul>
<li>building the latency testing stack</li>
<li>ways more speed is squeezed out of the system</li>
<li>tactics to add features without runtime latency overhead</li>
<li>hardware woes</li>
<li>supporting tooling buildout</li>
<li>design and deployment of this blog</li>
<li>unrelated projects I undertake</li>
</ul>

      </div>
    </article>
  </div>

    </main>
    <footer class="bg-black bottom-0 w-100 pa3" role="contentinfo">
  <div class="flex justify-between">
  <a class="f4 fw4 hover-white no-underline white-70 dn dib-ns pv2 ph3" href="http://localhost:1313/" >
    &copy;  Broken Gadgets R&D 2025 
  </a>
    <div><div class="ananke-socials"></div>
</div>
  </div>
</footer>

  </body>
</html>
